from nonebot import logger, on_command
from nonebot.params import CommandArg
from nonebot.adapters.onebot.v11 import Bot, Message
from nonebot.adapters.onebot.v11.event import GroupMessageEvent

emojiMap = {
    "惊讶": "114",
    "撇嘴": "101",
    "色": "102",
    "发呆": "103",
    "得意": "104",
    "流泪": "105",
    "害羞": "106",
    "闭嘴": "107",
    "睡": "108",
    "大哭": "400867",
    "尴尬": "110",
    "发怒": "111",
    "调皮": "112",
    "呲牙": "400823",
    "微笑": "100",
    "难过": "115",
    "酷": "116",
    "抓狂": "118",
    "吐": "119",
    "偷笑": "120",
    "可爱": "401181",
    "白眼": "122",
    "傲慢": "123",
    "饥饿": "124",
    "困": "125",
    "惊恐": "126",
    "流汗": "127",
    "憨笑": "128",
    "悠闲": "129",
    "奋斗": "130",
    "咒骂": "131",
    "疑问": "132",
    "嘘": "133",
    "晕": "134",
    "折磨": "135",
    "衰": "136",
    "骷髅": "137",
    "敲打": "138",
    "再见": "139",
    "发抖": "193",
    "爱情": "190",
    "跳跳": "192",
    "猪头": "162",
    "拥抱": "178",
    "蛋糕": "168",
    "刀": "171",
    "便便": "400643",
    "咖啡": "401262",
    "玫瑰": "400116",
    "凋谢": "164",
    "爱心": "400621",
    "心碎": "167",
    "太阳": "176",
    "月亮": "175",
    "赞": "179",
    "踩": "180",
    "握手": "181",
    "胜利": "182",
    "飞吻": "400846",
    "怄火": "194",
    "西瓜": "400132",
    "冷汗": "117",
    "擦汗": "140",
    "抠鼻": "141",
    "鼓掌": "400420",
    "糗大了": "143",
    "坏笑": "144",
    "左哼哼": "145",
    "右哼哼": "146",
    "哈欠": "147",
    "鄙视": "400414",
    "委屈": "149",
    "快哭了": "150",
    "阴险": "151",
    "左亲亲": "152",
    "吓": "153",
    "可怜": "154",
    "菜刀": "155",
    "篮球": "158",
    "示爱": "165",
    "抱拳": "183",
    "勾引": "184",
    "拳头": "400390",
    "差劲": "186",
    "NO": "188",
    "OK": "189",
    "转圈": "195",
    "挥手": "199",
    "鞭炮": "121002",
    "喝彩": "121009",
    "爆筋": "121011",
    "棒棒糖": "121012",
    "手枪": "400774",
    "茶": "241",
    "眨眼睛": "242",
    "泪奔": "243",
    "无奈": "244",
    "卖萌": "245",
    "小纠结": "246",
    "喷血": "247",
    "斜眼笑": "248",
    "doge": "249",
    "戳一戳": "251",
    "笑哭": "252",
    "我最美": "253",
    "羊驼": "255",
    "幽灵": "400562",
    "点赞": "271",
    "托腮": "282",
    "脑阔疼": "10262",
    "沧桑": "10263",
    "捂脸": "10264",
    "辣眼睛": "10265",
    "哦哟": "10266",
    "头秃": "10267",
    "问号脸": "10268",
    "暗中观察": "10269",
    "emm": "10270",
    "吃瓜": "10271",
    "呵呵哒": "10272",
    "我酸了": "10273",
    "汪汪": "10277",
    "无眼笑": "10281",
    "敬礼": "10282",
    "狂笑": "10283",
    "面无表情": "10284",
    "摸鱼": "10285",
    "魔鬼笑": "10286",
    "哦": "10287",
    "睁眼": "10289",
    "摸锦鲤": "10293",
    "期待": "10294",
    "拿到红包": "10295",
    "拜谢": "10297",
    "元宝": "10298",
    "牛啊": "10299",
    "胖三斤": "10300",
    "左拜年": "10302",
    "右拜年": "10303",
    "右亲亲": "10305",
    "牛气冲天": "10306",
    "喵喵": "10307",
    "打call": "10311",
    "变形": "10312",
    "仔细分析": "10314",
    "菜汪": "10317",
    "崇拜": "10318",
    "比心": "10319",
    "庆祝": "400198",
    "嫌弃": "10323",
    "吃糖": "10324",
    "惊吓": "10325",
    "生气": "10326",
    "举牌牌": "10332",
    "烟花": "10333",
    "虎虎生威": "10334",
    "豹富": "10336",
    "花朵脸": "10337",
    "我想开了": "10338",
    "舔屏": "10339",
    "打招呼": "10341",
    "酸Q": "10342",
    "我方了": "10343",
    "大怨种": "10344",
    "红包多多": "10345",
    "你真棒棒": "10346",
    "大展宏兔": "10347",
    "坚强": "10349",
    "贴贴": "10350",
    "敲敲": "10351",
    "咦": "10352",
    "拜托": "10353",
    "尊嘟假嘟": "10354",
    "耶": "10355",
    "666": "10356",
    "裂开": "10357",
    "龙年快乐": "10392",
    "新年中龙": "10393",
    "新年大龙": "10394",
    "略略略": "10395",
    "😊": "400832",
    "嘿嘿": "400832",
    "😌": "400834",
    "羞涩": "400834",
    "😚": "400848",
    "亲亲": "400848",
    "😓": "400841",
    "汗": "400841",
    "😰": "400870",
    "紧张": "400870",
    "😝": "400851",
    "吐舌": "400851",
    "😁": "400823",
    "😜": "400850",
    "淘气": "400850",
    "☺": "401181",
    "😍": "400835",
    "花痴": "400835",
    "😔": "400842",
    "失落": "400842",
    "😄": "400826",
    "高兴": "400826",
    "😏": "400837",
    "哼哼": "400837",
    "😒": "400840",
    "不屑": "400840",
    "😳": "400873",
    "瞪眼": "400873",
    "😘": "400846",
    "😭": "400867",
    "😱": "400871",
    "害怕": "400871",
    "😂": "400824",
    "激动": "400824",
    "💪": "400644",
    "肌肉": "400644",
    "👊": "400390",
    "👍": "400408",
    "厉害": "400408",
    "👏": "400420",
    "👎": "400414",
    "🙏": "400396",
    "合十": "400396",
    "👌": "400402",
    "好的": "400402",
    "👆": "400366",
    "向上": "400366",
    "👀": "400351",
    "眼睛": "400351",
    "🍜": "400151",
    "拉面": "400151",
    "🍧": "400162",
    "刨冰": "400162",
    "🍞": "400153",
    "面包": "400153",
    "🍺": "400181",
    "啤酒": "400181",
    "🍻": "400182",
    "干杯": "400182",
    "☕": "401262",
    "🍎": "400137",
    "苹果": "400137",
    "🍓": "400142",
    "草莓": "400142",
    "🍉": "400132",
    "🚬": "400987",
    "吸烟": "400987",
    "🌹": "400116",
    "🎉": "400198",
    "💝": "400631",
    "礼物": "400631",
    "💣": "400637",
    "炸弹": "400637",
    "✨": "401137",
    "闪光": "401137",
    "💨": "400642",
    "吹气": "400642",
    "💦": "400640",
    "水": "400640",
    "🔥": "400768",
    "火": "400768",
    "💤": "400638",
    "睡觉": "400638",
    "💩": "400643",
    "💉": "400611",
    "打针": "400611",
    "📫": "400714",
    "邮箱": "400714",
    "🐎": "400302",
    "骑马": "400302",
    "👧": "400459",
    "女孩": "400459",
    "👦": "400453",
    "男孩": "400453",
    "🐵": "400341",
    "猴": "400341",
    "🐷": "400343",
    "猪": "400343",
    "🐮": "400334",
    "牛": "400334",
    "🐔": "400308",
    "公鸡": "400308",
    "🐸": "400344",
    "青蛙": "400344",
    "👻": "400562",
    "🐛": "400315",
    "虫": "400315",
    "🐶": "400342",
    "狗": "400342",
    "🐳": "400339",
    "鲸鱼": "400339",
    "👢": "400449",
    "靴子": "400449",
    "☀": "401328",
    "晴天": "401328",
    "❔": "401145",
    "问号": "401145",
    "🔫": "400774",
    "💓": "400621",
    "🏪": "400281",
    "便利店": "400281",
}


@on_command("e").handle()
async def _(bot: Bot, event: GroupMessageEvent, message: Message = CommandArg()):
    reply = event.reply

    if reply is None:
        return

    emojiId = None
    if len(faces := message.get("face", 1)) > 0:
        emojiId = faces[0].data.get("id")
        logger.info(f'emojiData: {faces[0].data.get("id")} {message.get("face", 1)}')
    elif len(text := message.get("text", 1)) > 0:
        try:
            emojiId = int(str(text[0]))
        except:
            emojiId = emojiMap.get(str(text[0]))

    try:
        await bot.delete_msg(message_id=event.message_id)
    except:
        logger.error(f"delete message failed {event.message_id}")

    logger.info(f"reaction: {reply.message_id} {event.message_id} {emojiId} {message.get('face', 1)}")
    if emojiId is None:
        return await bot.call_api("set_msg_emoji_like", message_id=event.message_id, emoji_id=38)

    await bot.call_api("set_msg_emoji_like", message_id=reply.message_id, emoji_id=emojiId)
